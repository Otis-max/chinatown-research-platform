<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>welcome to my world CHINATOWN</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css" rel="stylesheet">
    <!-- AOS 动画库 -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/aos/2.3.4/aos.css" rel="stylesheet">
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@300;400;500;700&display=swap" rel="stylesheet">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Noto Sans SC', sans-serif;
            line-height: 1.6;
            overflow-x: hidden;
            padding-top: 50px;
            background: #f5f5f5;
            min-height: 100vh;
            position: relative;
        }

        
        
        /* 导航栏样式 */
        .navbar {
            background: rgba(51, 51, 51, 0.95);
            backdrop-filter: blur(10px);
            transition: all 0.3s ease;
            box-shadow: 0 2px 20px rgba(0,0,0,0.15);
            padding: 9px 0; 
        }
        
        .navbar-brand {
            font-weight: 700;
            color: #dc3545 !important;
            font-size: 4rem;
            display: flex;
            align-items: center;
            text-decoration: none;
            padding: 0;
        }

        .navbar-logo {
            height: 60px;
            width: auto;
            transition: transform 0.3s ease;
        }

        .navbar-logo:hover {
            transform: scale(1.05);
        }

        /* 响应式设计 - 小屏幕时稍微缩小 */
        @media (max-width: 768px) {
            .navbar-logo {
                height: 45px;
            }
            
            .navbar-brand {
                font-size: 1.6rem;
            }
            
            .nav-link {
                font-size: 1.1rem;
                margin: 0 10px;
            }
            
            .navbar {
                padding: 6px 0;
            }
        }
        
        .nav-link {
            color: white !important;
            font-weight: 500;
            margin: 0 10px;
            transition: color 0.3s ease;
            font-size: 1.2rem;
        }
        
        .nav-link:hover {
            color: #dc3545 !important;
        }
        
        /* 卡片网格 */
        .card-grid {
            padding: 5rem 0;
            background: rgba(248, 249, 250, 0.6);
            backdrop-filter: blur(5px);
        }
        
        .feature-card {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            border: none;
            border-radius: 15px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.08);
            transition: all 0.3s ease;
            height: 300px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            cursor: pointer;
            overflow: hidden;
            position: relative;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .feature-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, #dc3545, #c82333);
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        
        .feature-card:hover {
            transform: translateY(-10px);
            box-shadow: 0 25px 45px rgba(0,0,0,0.12);
        }
        
        .feature-card:hover::before {
            opacity: 0.9;
        }
        
        .feature-card:hover .card-content {
            color: white;
            z-index: 2;
            position: relative;
        }
        
        .card-icon {
            font-size: 3rem;
            color: #dc3545;
            margin-bottom: 1rem;
            transition: color 0.3s ease;
        }
        
        .feature-card:hover .card-icon {
            color: white;
        }
        
        .card-content h3 {
            font-size: 1.5rem;
            font-weight: 600;
            margin-bottom: 1rem;
            transition: color 0.3s ease;
        }
        
        .card-content p {
            font-size: 1rem;
            line-height: 1.6;
            transition: color 0.3s ease;
        }
        
        /* 内容区域 */
        .content-section {
            padding: 5rem 0;
            position: relative;
        }

        /* 装饰性元素 */
        
        
        .section-title {
            text-align: center;
            margin-bottom: 3rem;
        }
        
        .section-title h2 {
            font-size: 2.5rem;
            font-weight: 700;
            color: #2c1810;
            margin-bottom: 1rem;
            text-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .section-title p {
            font-size: 1.2rem;
            color: #5d4e42;
            max-width: 600px;
            margin: 0 auto;
        }

        .chart-description {
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 15px;
            padding: 25px;
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.08);
            margin: 20px 0;
            line-height: 1.6;
        }

        .chart-description p {
            color: #4a3c32;
        }

        .historical-origin-content {
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 15px;
            padding: 25px;
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.08);
            margin: 20px 0;
        }

        .historical-origin-content h3 {
            color: #2c1810;
            margin-bottom: 1.5rem;
        }

        .historical-origin-content p {
            color: #4a3c32;
            line-height: 1.7;
        }

        .chart-container {
            background: #ffffff; 
            border-radius: 15px; 
            box-shadow: 0 15px 35px rgba(0,0,0,0.08);
            overflow: hidden; 
            margin-bottom: 3rem;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .chart-section .chart-title h3 {
            color: #2c1810;
            text-align: center;
            margin-bottom: 2rem;
            font-size: 2rem;
            font-weight: 600;
        }
        
        /* 页脚 */
        .footer {
            background: rgba(51, 51, 51, 0.95);
            backdrop-filter: blur(10px);
            color: white;
            padding: 1.5rem 0 0.5rem;
            text-align: center;
            margin-top: 3rem;
        }
        
        /* 响应式设计 */
        @media (max-width: 768px) {
            .hero-content h1 {
                font-size: 2.5rem;
            }
            
            .hero-content p {
                font-size: 1.1rem;
            }
            
            .feature-card {
                height: 250px;
                margin-bottom: 2rem;
            }

            .section-title h2 {
                font-size: 2rem;
            }
        }
        
        /* 滚动动画 */
        .fade-up {
            opacity: 0;
            transform: translateY(30px);
            transition: all 0.6s ease;
        }
        
        .fade-up.aos-animate {
            opacity: 1;
            transform: translateY(0);
        }

        /* Chart styles - 修改图表容器背景为白色 */
        #chartdiv {
            overflow: auto;
            background: #ffffff !important; /* 强制白色背景 */
            border-radius: 15px;
            padding: 20px;
        }

        #serpentinediv {
            width: 50%;
            height: 600px;
            float: left;
            background: #ffffff !important; /* 强制白色背景 */
        }

        #mapdiv {
            width: 50%;
            height: 600px;
            float: left;
            background: #ffffff !important; /* 强制白色背景 */
        }

        @media (max-width: 768px) {
            #serpentinediv, #mapdiv {
                width: 100%;
                height: 400px;
                float: none;
                background: #ffffff !important; /* 强制白色背景 */
            }
        }
    </style>
</head>
<body>
    <!-- 导航栏 -->
    <nav class="navbar navbar-expand-lg fixed-top">
        <div class="container">
            <a class="navbar-brand" href="#">
                <img src="tubiao.jpg" alt="唐人街商标" class="navbar-logo">
            </a>

            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="Chinatown2025.html">Home</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="About us.html">About</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="Origin.html">Origin</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="Development.html">Development</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="Current situation.html">Current situation</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="Video.html">Festival</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="Contact us.html">Contact us</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- 唐人街时间轴 -->
    <section id="history" class="content-section">
        <div class="container">
            <div class="section-title" data-aos="fade-up">
                <h2>Development History of Famous Chinatowns</h2>
                <p>Immigration waves spanning two centuries have witnessed the establishment of Chinese communities in different countries.</p>
            </div>
            
            <!-- 时间轴图表 -->
            <div class="row" data-aos="fade-up" data-aos-delay="200">
                <div class="col-12">
                    <div class="chart-container">
                        <iframe src='https://cdn.knightlab.com/libs/timeline3/latest/embed/index.html?source=v2%3A2PACX-1vRqcUf36ImYyA3UujOcXvTXkK12NBNcu6C5HT9SmXybmYVnjDpNNVvNgM-npupLmWLI-YBxKXmcPKBD&font=Default&lang=en&initial_zoom=2&width=100%25&height=650' width='100%' height='650' webkitallowfullscreen mozallowfullscreen allowfullscreen frameborder='0'></iframe>
                    </div>
                </div>
            </div>
            
            <div class="row align-items-center">
                <div class="col-lg-6" data-aos="fade-right">
                    <div class="historical-origin-content">
                        <h3>Historical Origin</h3>
                        <p>The history of Chinatown can be traced back to the mid-19th century, when it was formed with the large-scale migration of Chinese immigrants. In order to survive and develop in a foreign country, these early Chinese immigrants naturally gathered together and formed a unique community culture.</p>
                        <p>From the initial temporary settlement to the later development into a community with complete commercial and cultural functions, Chinatown carries the struggle history and cultural heritage of Chinese immigrants.</p>
                    </div>
                </div>
                <div class="col-lg-6" data-aos="fade-left">
                    <div style="height: 300px; background: linear-gradient(45deg, #dc3545, #c82333); border-radius: 15px; display: flex; align-items: center; justify-content: center; color: white; font-size: 1.2rem; padding: 20px; box-shadow: 0 15px 35px rgba(220, 53, 69, 0.2);">
                        <img src="https://iknow-base.cdn.bcebos.com/zhidaoribao/2019/1002/jiujinshan.png?x-bce-process=image/quality,q_80" 
                             alt="旧金山唐人街历史照片" 
                             style="width: 100%; height: 100%; object-fit: cover; border-radius: 10px;">
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- 图表标题 -->
    <div class="chart-section">
        <div class="container">
            <div class="chart-title" data-aos="fade-up">
                <h3>Top 10 most populous Chinatowns in the world</h3>
            </div>
            
            <!-- HTML -->
            <div id="chartdiv" data-aos="fade-up" data-aos-delay="200">
                <div id="serpentinediv"></div>
                <div id="mapdiv"></div>
            </div>
            
            <!-- 图表描述 -->
            <div class="chart-description" data-aos="fade-up" data-aos-delay="400">
                <p>This comprehensive visualization presents the top 10 most populous Chinatowns worldwide through two perspectives. </p>
                <p>The left chart displays communities arranged by their distance from China, with Singapore being the closest at 4,500km and Manhattan the farthest at 11,000km. The right world map shows their actual geographic locations with circle sizes representing population density. Singapore leads with over 1 million Chinese residents, followed by major communities across North America, Europe, and Australia. </p>
            </div>
        </div>
    </div>
  
    <!-- 页脚 -->
    <footer class="footer">
        <div class="container">
            <p>&copy; 2025 Universiti Malaya MLIS. All rights reserved.</p>
            <p>Explore the development of Chinatown and inherit Chinese civilization</p>
            <p>Designed by &nbsp &nbsp &nbsp &nbspZHAO XIAOMING  &nbsp &nbsp &nbsp &nbsp ZHOU SHENGNAN</p>
            <p>LU WEIXIN &nbsp &nbsp &nbsp &nbsp  GUO JIAYI &nbsp &nbsp &nbsp &nbsp LI JIALIN</p>
        </div>
    </footer>

    <!-- Bootstrap JS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>
    <!-- AOS 动画库 -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/aos/2.3.4/aos.js"></script>
    
    <!-- amCharts 库 -->
    <script src="https://cdn.amcharts.com/lib/5/index.js"></script>
    <script src="https://cdn.amcharts.com/lib/5/flow.js"></script>
    <script src="https://cdn.amcharts.com/lib/5/xy.js"></script>
    <script src="https://cdn.amcharts.com/lib/5/timeline.js"></script>
    <script src="https://cdn.amcharts.com/lib/5/map.js"></script>
    <script src="https://cdn.amcharts.com/lib/5/geodata/worldLow.js"></script>
    <script src="https://cdn.amcharts.com/lib/5/themes/Animated.js"></script>
    
    <script>
        // 初始化 AOS 动画
        AOS.init({
            duration: 800,
            easing: 'ease-in-out',
            once: true
        });
        
        // 数字计数动画
        function animateCounters() {
            const counters = document.querySelectorAll('.stat-number');
            
            counters.forEach(counter => {
                const target = parseInt(counter.getAttribute('data-count'));
                const duration = 2000; // 2秒
                const step = target / (duration / 16); // 60fps
                let current = 0;
                
                const updateCounter = () => {
                    current += step;
                    if (current < target) {
                        counter.textContent = Math.floor(current);
                        requestAnimationFrame(updateCounter);
                    } else {
                        counter.textContent = target;
                    }
                };
                
                updateCounter();
            });
        }
        
        // 监听滚动到统计区域时触发计数动画
        const statsSection = document.querySelector('.stats-section');
        if (statsSection) {
            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        animateCounters();
                        observer.unobserve(entry.target);
                    }
                });
            });
            
            observer.observe(statsSection);
        }
        
        // 平滑滚动
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                e.preventDefault();
                const target = document.querySelector(this.getAttribute('href'));
                if (target) {
                    target.scrollIntoView({
                        behavior: 'smooth',
                        block: 'start'
                    });
                }
            });
        });

        // amCharts initialization - 修改为白色背景
        am5.ready(function() {
            var mainColor = am5.color(0xc83830);
            var secondaryColor = am5.color(0xd9cec8);
            var pointSeries;
            var serpentineSeries;

            var data = [
                {
                    "distance": 0,
                    "category": "city",
                    "name": "China",
                    "altitude": 112,
                    "rank": 0,
                    "geometry": { "type": "Point", "coordinates": [116.4074, 39.9042] }
                },
                {
                    "distance": 4500,
                    "category": "city",
                    "name": "Singapore",
                    "altitude": 100,
                    "rank": 1,
                    "population": 1000000,
                    "geometry": { "type": "Point", "coordinates": [103.8439, 1.2831] }
                },
                {
                    "distance": 8150,
                    "category": "city",
                    "name": "London",
                    "altitude": 34,
                    "rank": 9,
                    "population": 350000,
                    "geometry": { "type": "Point", "coordinates": [-0.1306, 51.5115] }
                },
                {
                    "distance": 8200,
                    "category": "city",
                    "name": "Paris",
                    "altitude": 2,
                    "rank": 10,
                    "population": 320000,
                    "geometry": { "type": "Point", "coordinates": [2.3656, 48.8286] }
                },
                {
                    "distance": 8500,
                    "category": "city",
                    "name": "Vancouver",
                    "altitude": 13,
                    "rank": 6,
                    "population": 510000,
                    "geometry": { "type": "Point", "coordinates": [-123.1035, 49.2796] }
                },
                {
                    "distance": 8900,
                    "category": "city",
                    "name": "Sydney",
                    "altitude": 35,
                    "rank": 5,
                    "population": 550000,
                    "geometry": { "type": "Point", "coordinates": [151.2057, -33.8783] }
                },
                {
                    "distance": 9000,
                    "category": "city",
                    "name": "Melbourne",
                    "altitude": 408,
                    "rank": 8,
                    "population": 410000,
                    "geometry": { "type": "Point", "coordinates": [144.9615, -37.8106] }
                },
                {
                    "distance": 9500,
                    "category": "city",
                    "name": "San Francisco",
                    "altitude": 171,
                    "rank": 2,
                    "population": 820000,
                    "geometry": { "type": "Point", "coordinates": [-122.4079, 37.7944] }
                },
                {
                    "distance": 10000,
                    "category": "city",
                    "name": "Los Angeles",
                    "altitude": 96,
                    "rank": 7,
                    "population": 480000,
                    "geometry": { "type": "Point", "coordinates": [-118.2386, 34.0625] }
                },
                {
                    "distance": 10600,
                    "category": "city",
                    "name": "Toronto",
                    "altitude": 1,
                    "rank": 4,
                    "population": 750000,
                    "geometry": { "type": "Point", "coordinates": [-79.3972, 43.6532] }
                },
                {
                    "distance": 11000,
                    "category": "city",
                    "name": "Manhattan",
                    "altitude": 14,
                    "rank": 3,
                    "population": 780000,
                    "geometry": { "type": "Point", "coordinates": [-73.9970, 40.7158] }
                }
            ];

            makeMapChart();
            makeSerpentineChart();

            function makeMapChart() {
                var root = am5.Root.new("mapdiv");
                
                // 设置白色背景
                root.setThemes([am5themes_Animated.new(root)]);
                root.interfaceColors.set("fill", am5.color("#ffffff"));
                root.dom.style.backgroundColor = "#ffffff";

                var chart = root.container.children.push(am5map.MapChart.new(root, {
                    panX: "translateX",
                    panY: "translateY",
                    projection: am5map.geoMercator(),
                    homeGeoPoint: { longitude: 8.7, latitude: 50.5 },
                    homeZoomLevel: 1.7,
                    background: am5.Rectangle.new(root, {
                        fill: am5.color("#ffffff")
                    })
                }));

                var polygonSeries = chart.series.push(am5map.MapPolygonSeries.new(root, {
                    geoJSON: am5geodata_worldLow
                }));

                polygonSeries.mapPolygons.template.setAll({
                    fill: secondaryColor,
                    stroke: am5.color(0xffffff),
                    strokeWidth: 1,
                    strokeOpacity: 0.5
                });

                polygonSeries.events.on("datavalidated", function () {
                    chart.goHome();
                });

                var lineSeries = chart.series.push(am5map.MapLineSeries.new(root, {}));
                lineSeries.mapLines.template.setAll({
                    stroke: am5.color(0x000000),
                    strokeDasharray: [3, 3],
                    strokeWidth: 1,
                    strokeOpacity: .5
                });

                pointSeries = chart.series.push(am5map.MapPointSeries.new(root, {
                    valueField: "population",
                    calculateAggregates: true,
                    idField: "name"
                }));

                var circleTemplate = am5.Template.new(root, {});

                pointSeries.set("heatRules", [{
                    target: circleTemplate,
                    min: 3,
                    max: 17,
                    dataField: "value",
                    key: "radius"
                }]);

                pointSeries.bullets.push(function (root, series, dataItem) {
                    var container = am5.Container.new(root, {});
                    var circle = container.children.push(am5.Circle.new(root, {
                        radius: 9,
                        fill: mainColor,
                        stroke: mainColor,
                        strokeWidth: 1,
                        strokeOpacity: 0.8,
                        fillOpacity: 0.7,
                        layer: 30
                    }, circleTemplate));

                    circle.states.create("hover", {
                        scale: 1.4,
                        fillOpacity: 1
                    });

                    circle.events.on("pointerover", function (ev) {
                        var dataItem = ev.target.dataItem;
                        if (dataItem) {
                            var city = dataItem.dataContext.name;
                            var di = serpentineSeries.getDataItemById(city);

                            if (di) {
                                var bullet = di.bullets[0];
                                
                                if (bullet) {
                                    var container = bullet.get("sprite");
                                    var c = container.children.getIndex(0);
                                    if (c) {
                                        c.hover();
                                    }
                                }
                            }
                        }
                    });

                    circle.events.on("pointerout", function (ev) {
                        var dataItem = ev.target.dataItem;
                        if (dataItem) {
                            var city = dataItem.dataContext.name;
                            var di = serpentineSeries.getDataItemById(city);

                            if (di) {
                                var bullet = di.bullets[0];
                                
                                if (bullet) {
                                    var container = bullet.get("sprite");
                                    var c = container.children.getIndex(0);
                                    if (c) {
                                        c.unhover();
                                    }
                                }
                            }
                        }
                    });

                    var label = container.children.push(am5.Label.new(root, {
                        text: "{name}",
                        fontSize: 13,
                        centerY: am5.p50,
                        centerX: am5.p100,
                        populateText: true,
                        layer: 30,
                        paddingRight: 4
                    }));

                    label.adapters.add("dx", function (dy, target) {
                        return -circle.get("radius");
                    });

                    return am5.Bullet.new(root, {
                        sprite: container,
                        locationX: 0,
                        locationY: 0.5
                    });
                });

                pointSeries.data.setAll(data);

                var pointsToConnect = [];
                am5.array.each(pointSeries.dataItems, function (dataItem) {
                    pointsToConnect.push(dataItem);
                });

                lineSeries.pushDataItem({
                    pointsToConnect: pointsToConnect
                });

                chart.appear(1000, 100);
            }

            function makeSerpentineChart() {
                var root = am5.Root.new("serpentinediv");
                
                // 设置白色背景
                root.setThemes([am5themes_Animated.new(root)]);
                root.interfaceColors.set("fill", am5.color("#ffffff"));
                root.dom.style.backgroundColor = "#ffffff";

                var chart = root.container.children.push(am5timeline.SerpentineChart.new(root, {
                    levelCount: 3,
                    startLocation: 0.2,
                    endLocation: 1,
                    wheelY: "zoomX",
                    yAxisRadius: am5.percent(20),
                    background: am5.Rectangle.new(root, {
                        fill: am5.color("#ffffff")
                    })
                }));

                var yRenderer = am5timeline.AxisRendererCurveY.new(root, {});

                yRenderer.labels.template.setAll({
                    forceHidden: true
                });

                yRenderer.grid.template.set("forceHidden", true);

                var xRenderer = am5timeline.AxisRendererCurveX.new(root, {
                    yRenderer: yRenderer,
                    strokeDasharray: [2, 3],
                    strokeWidth: 2,
                    strokeOpacity: 0.5,
                    stroke: am5.color(0x000000)
                });

                xRenderer.labels.template.setAll({
                    centerY: am5.p50,
                    fontSize: 11,
                    fill: am5.color(0x777777),
                    minPosition: 0.01,
                    maxPosition: 0.99
                });

                xRenderer.grid.template.set("forceHidden", true);

                xRenderer.labels.template.setup = function (target) {
                    target.set("layer", 30);
                    target.set("background", am5.Rectangle.new(root, {
                        fill: am5.color(0xffffff),
                        fillOpacity: 1
                    }));
                }

                var yAxis = chart.yAxes.push(am5xy.CategoryAxis.new(root, {
                    maxDeviation: 0,
                    categoryField: "category",
                    renderer: yRenderer
                }));

                var xAxis = chart.xAxes.push(am5xy.ValueAxis.new(root, {
                    renderer: xRenderer,
                    numberFormat: "#' km'"
                }));

                var colorSet = chart.get("colors");

                serpentineSeries = chart.series.push(am5timeline.CurveLineSeries.new(root, {
                    xAxis: xAxis,    
                    yAxis: yAxis,
                    baseAxis: yAxis,
                    valueField: "population",
                    valueXField: "distance",
                    categoryYField: "category",
                    idField: "name",
                    maskBullets: false,
                    calculateAggregates: true
                }));

                serpentineSeries.strokes.template.setAll({
                    forceHidden: true
                });

                var circleTemplate = am5.Template.new(root, {});

                serpentineSeries.set("heatRules", [{
                    target: circleTemplate,
                    min: 3,
                    max: 35,
                    dataField: "value",
                    key: "radius"
                }]);

                serpentineSeries.bullets.push(function (root, series, dataItem) {
                    var container = am5.Container.new(root, {});

                    var circle = container.children.push(am5.Circle.new(root, {
                        radius: 9,
                        fill: mainColor,
                        stroke: mainColor,
                        strokeWidth: 2,
                        strokeOpacity: 0.8,
                        layer: 30,
                        tooltipText: "[bold fontSize: 20px]{name}[/]\nRank: {rank}\nPopulation: {population}",
                        tooltipY: 0,
                        fillOpacity: 0.7
                    }, circleTemplate));

                    circle.states.create("hover", {
                        scale: 1.5,
                        fillOpacity: 1
                    });

                    circle.events.on("pointerover", function (ev) {
                        var dataItem = ev.target.dataItem;
                        if (dataItem) {
                            var city = dataItem.dataContext.name;
                            var di = pointSeries.getDataItemById(city);

                            if (di) {
                                var bullet = di.bullets[0];
                                
                                if (bullet) {
                                    var container = bullet.get("sprite");
                                    var c = container.children.getIndex(0);
                                    if (c) {
                                        c.hover();
                                    }
                                }
                            }
                        }
                    });

                    circle.events.on("pointerout", function (ev) {
                        var dataItem = ev.target.dataItem;
                        if (dataItem) {
                            var city = dataItem.dataContext.name;
                            var di = pointSeries.getDataItemById(city);

                            if (di) {
                                var bullet = di.bullets[0];
                                
                                if (bullet) {
                                    var container = bullet.get("sprite");
                                    var c = container.children.getIndex(0);
                                    if (c) {
                                        c.unhover();
                                    }
                                }
                            }
                        }
                    });

                    var label = container.children.push(am5.Label.new(root, {
                        text: "{name}",
                        fontSize: 13,
                        centerY: am5.p100,
                        centerX: am5.p50,
                        populateText: true,
                        layer: 30
                    }));

                    label.adapters.add("dy", function (dy, target) {
                        return -circle.get("radius");
                    });

                    return am5.Bullet.new(root, {
                        sprite: container,
                        locationX: 0,
                        locationY: 0.5
                    });
                });

                var cursor = chart.set("cursor", am5timeline.CurveCursor.new(root, {
                    behavior: "zoomX",
                    xAxis: xAxis,
                    yAxis: yAxis
                }));

                cursor.lineY.set("forceHidden", true);
                cursor.lineX.set("forceHidden", true);

                serpentineSeries.data.setAll(data);

                yAxis.data.setAll([
                    { category: "city" }
                ]);

                serpentineSeries.appear(1000);
                chart.appear(1000, 100);
            }
        });
    </script>
</body>
</html>
